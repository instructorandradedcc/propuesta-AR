<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>PROPUESTA en SALUD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.152.2/examples/jsm/"
            }
        }
    </script>
    
    <style>
        /* Estilos sin cambios */
        html.ar-active, body.ar-active { overflow: hidden; width: 100%; height: 100%; margin: 0; padding: 0; }
        #app { transition: all 0.3s ease-in-out; }
        .app-container.ar-fullscreen { position: fixed; top: 0; left: 0; right: 0; bottom: 0; width: 100%; height: 100%; max-height: none; padding: 0; margin: 0 !important; border-radius: 0; overflow: hidden; }
        .page { display: none; }
        .page.active { display: block; }
        #editor-canvas { width: 100%; height: 400px; border: 1px solid #ccc; background: #f0f0f0; cursor: move; touch-action: none; border-radius: 8px; }
        #ar-scene-container.ar-active { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9990; }
        #ar-scene-container.ar-active a-scene { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        #ar-scene-container.ar-active video, #ar-scene-container.ar-active canvas { position: absolute !important; top: 50% !important; left: 50% !important; transform: translate(-50%, -50%) !important; min-width: 100% !important; min-height: 100% !important; width: auto !important; height: auto !important; object-fit: cover !important; cursor: grab; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #scanning-ui { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9991; display: flex; flex-direction: column; justify-content: center; align-items: center; pointer-events: none; background-color: rgba(0,0,0,0.3); transition: opacity 0.3s; }
        #scanning-ui.hidden { display: none; }
        .scan-text { margin-top: 24px; padding: 8px 16px; background-color: rgba(0,0,0,0.5); color: white; font-size: 1.1rem; border-radius: 8px; text-shadow: 1px 1px 2px black; }
        #ar-active-controls { position: fixed; bottom: 0; left: 0; width: 100%; z-index: 9999; }
    </style>
</head>
<body class="bg-gray-200 text-gray-800 font-sans">
    <div id="app" class="relative app-container container mx-auto p-6 md:p-8 max-w-5xl bg-white rounded-xl shadow-lg my-8 overflow-y-auto" style="max-height: 85vh;">
        <div id="version-tag" class="absolute top-2 right-4 text-xs text-gray-400">v2.4</div>

        <div class="flex justify-center items-center mb-6">
             <img src="https://raw.githubusercontent.com/instructorandradedcc/propuesta-AR/main/logofundacion.jpg" alt="Logo Prototipo" class="h-20 w-auto mr-4" onerror="this.onerror=null;this.src='https://placehold.co/120x80/e2e8f0/94a3b8?text=Logo';">
             <div>
                 <h1 class="text-4xl font-bold text-center" style="color: #1e3a8a;">PROPUESTA en SALUD</h1>
                 <p class="text-center text-gray-500">Visualización de modelos anatómicos con Realidad Aumentada.</p>
             </div>
        </div>
        
        <div id="page-upload" class="page active bg-white p-6 rounded-lg shadow-md"></div>
        <div id="page-editor" class="page bg-white p-6 rounded-lg shadow-md"></div>
        <div id="page-ar" class="page"></div>
        
    </div>
    <div id="ar-preloader" class="hidden fixed inset-0 bg-black bg-opacity-75 flex flex-col justify-center items-center z-[10000]"></div>
    
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { DragControls } from 'three/addons/controls/DragControls.js';

        document.addEventListener('DOMContentLoaded', () => {
            // ... (state, editor, y el componente ar-rotator se mantienen igual)

            const CACHE_NAME = 'propuesta-salud-ar-cache-v2.4';
            const GITHUB_BASE_URL = 'https://raw.githubusercontent.com/instructorandradedcc/propuesta-AR/main/asetss/';
            
            // --- INICIO DE PRUEBA DE DEPURACIÓN ---
            // Para aislar el problema, vamos a probar cargando UN SOLO asset a la vez.
            // Para probar un marcador diferente, comenta la línea actual y descomenta la que quieras probar.
            
            // const ASSET_NAMES = ['cabeza1']; // Prueba 1: El que sabemos que funciona.
            const ASSET_NAMES = ['corazon']; // Prueba 2: Uno de los que no funcionan.
            // const ASSET_NAMES = ['dedo']; // Prueba 3: Otro que no funciona.
            // ... puedes añadir más líneas para probar los otros individualmente.
            
            /*
            // Lista completa de assets (desactivada temporalmente para la prueba)
            const ASSET_NAMES_FULL = [
                'cabeza1', 'corazon', 'dedo-mano', 'dedo', 'hueso-columna', 
                'huesosmano', 'mano-iz-protesis', 'protesis-mano-brazo'
            ];
            */
            // --- FIN DE PRUEBA DE DEPURACIÓN ---


            // El resto del código JS (funciones de carga, de AR, etc.) es idéntico a la v2.3
            // ...
        });
    </script>
</body>
</html>
